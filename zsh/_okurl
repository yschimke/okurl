#compdef okurl
#autoload

_okurl_services() {
    services=($(okurl --complete service))
    compadd $services
}

_okurl_urls() {
  local host urlpath

  urls=($(okurl --urlCompletion https))
  compadd $urls
}

_okurl() {
  local curcontext="$curcontext" state state_descr line expl
  typeset -A opt_args

  _arguments -C -S \
    --user-agent='[User-Agent to send to server]' \
    --connect-timeout='[Maximum time allowed for connection (seconds). (0 = disabled)]' \
    --read-timeout='[Maximum time allowed for reading data (seconds). (0 = disabled)]' \
    --ping-interval='[Interval between pings. (0 = disabled)]' \
    --frames'[Log HTTP/2 frames to STDERR]' \
    --wireshark'[Wireshark Frames]' \
    --debug'[Debug]' \
    --opensc'[Use OpenSC key manager]' \
    --cache='[Cache directory]' \
    --protocols='[Protocols]' \
    --tracing='[Activate Zipkin Tracing]' \
    '--ip=[IP Preferences (system, ipv4, ipv6, ipv4only, ipv6only)]: :(system ipv4 ipv6 ipv4only ipv6only)' \
    '--dns=[DNS (java, dnsoverhttps)]: :(netty java dnsoverhttps)' \
    '--dnsServers=[Specific DNS Servers (csv, google)]: :(csv google)' \
    --resolve='[DNS Overrides (HOST:TARGET)]' \
    --certificatePin='[Certificate Pin to define host:pinsha]' \
    '--networkInterface=[Specific Local Network Interface]: :->networkInterface' \
    '--connectionSpec=[Connection Spec (RESTRICTED_TLS, MODERN_TLS, COMPATIBLE_TLS)]: :(RESTRICTED_TLS MODERN_TLS COMPATIBLE_TLS)' \
    --cipherSuite='[Cipher Suites]' \
    --tlsVersions='[TLS Versions]'\
    --proxy='[Use HTTP proxy]' \
    --ssldebug'[SSL Debug]' \
    --user='[user:password for basic auth]' \
    --maxrequests='[Concurrency Level]' \
    --curl'[Show curl commands]' \
    --noFollow'[Follow redirects]' \
    --referer='[Referer URL]' \
    --authorize='[Authorize API]: :_okurl_services' \
    --renew'[Renew API Authorization]' \
    --remove'[Remove API Authorization]' \
    --token='[Use existing Token for authorization]' \
    --showCredentials'[Show Credentials]' \
    --complete='[Complete options]' \
    --urlCompletion'[URL Completion]' \
    --apidoc'[API Documentation]' \
    {-o,--output}='[Output file]' \
    {-k,--insecure}'[Allow connections to SSL sites without certs]' \
    {-i,--include}'[Include protocol headers in the output]' \
    {-s,--set}='[Token Set e.g. work]' \
    {-r,--raw}'[Raw Output]' \
    {-X,--request}='[Specify request command to use]' \
    {-d,--data}='[HTTP POST data]' \
    {-H,--header}='[Custom header to pass to server]' \
    {-h,--help}'[Show this help message and exit.]' \
    {-V,--version}'[Print version information and exit.]' \
    '*:URLs:_okurl_urls' \
    && ret=0
}

_okurl "$@"
